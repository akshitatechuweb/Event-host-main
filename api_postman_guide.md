# Payment API Postman Testing Guide

This guide provides the necessary URLs, request bodies, and headers to test both Razorpay and PhonePe payment flows.

## üîë Authentication

Most endpoints require a **Bearer Token** from a user with one of the following roles:

- `user`
- `host` (New!)
- `admin`
- `superadmin`

---

## üí≥ PhonePe APIs (New & Refactored)

### 1. Initiate PhonePe Payment

**Endpoint**: `POST /api/payment/phonepe/initiate`  
**Description**: Starts the PhonePe flow and returns a `paymentUrl`.

**Request Body (JSON)**:

```json
{
  "eventId": "67866380cce2898950543e26",
  "items": [
    {
      "passType": "Male",
      "price": 500,
      "quantity": 1
    }
  ],
  "attendees": [
    {
      "fullName": "John Doe",
      "email": "john@example.com",
      "phone": "9876543210",
      "gender": "Male",
      "passType": "Male"
    }
  ],
  "couponCode": "WELCOME10"
}
```

### 2. Check PhonePe Status

**Endpoint**: `GET /api/payment/phonepe/status/:transactionId`  
**Description**: Manually check if a transaction was successful. Replace `:transactionId` with the `transactionId` returned from the initiate call (e.g., `MT17371131...`).

### 3. PhonePe Webhook (Callback)

**Endpoint**: `POST /api/payment/phonepe/callback`  
**Description**: Simulates the server-to-server notification from PhonePe. Requires a base64 encoded response from PhonePe. (Usually tested by the system itself).

---

## üí≥ Razorpay APIs (Legacy)

### 1. Create Razorpay Order

**Endpoint**: `POST /api/payment/create-order`  
**Description**: Generates a Razorpay `orderId`.

**Request Body (JSON)**:

```json
{
  "eventId": "67866380cce2898950543e26",
  "items": [
    {
      "passType": "Male",
      "price": 500,
      "quantity": 1
    }
  ],
  "couponCode": "FIRST50"
}
```

### 2. Verify Razorpay Payment

**Endpoint**: `POST /api/payment/verify-payment`  
**Description**: Finalizes the booking after Razorpay success.

**Request Body (JSON)**:

```json
{
  "razorpay_order_id": "order_Pi8v0h1pPQ",
  "eventId": "67866380cce2898950543e26",
  "items": [{ "passType": "Male", "price": 500, "quantity": 1 }],
  "attendees": [
    {
      "fullName": "Jane Doe",
      "email": "jane@example.com",
      "phone": "9876543211",
      "gender": "Female",
      "passType": "Female"
    }
  ],
  "subtotal": 500,
  "discountAmount": 0,
  "taxAmount": 50
}
```

---

## üåê Dynamic Endpoints (For Info)

- **PhonePe Redirect Handler**: `GET /api/payment/phonepe/handle-redirect?id=MT...&code=PAYMENT_SUCCESS`
- **Base URL**: Use `http://localhost:8000` for local testing.

---

_Generated by Antigravity_
